<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>วัดไชยามาตย์ - ระบบบริจาคออนไลน์</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: { 50: '#fff7ed', 100: '#ffedd5', 200: '#fed7aa', 300: '#fdba74', 400: '#fb923c', 500: '#f97316', 600: '#ea580c', 700: '#c2410c', 800: '#9a3412', 900: '#7c2d12' },
                        gold: { 400: '#fbbf24', 500: '#f59e0b', 600: '#d97706' }
                    },
                    fontFamily: {
                        sans: ['Prompt', 'sans-serif'],
                    },
                    boxShadow: {
                        'soft': '0 20px 40px -15px rgba(0, 0, 0, 0.1)',
                        'glow': '0 0 20px rgba(249, 115, 22, 0.3)',
                    }
                }
            }
        }
    </script>
    
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&family=Prompt:wght@200;300;400;500;600;700&display=swap" rel="stylesheet">

    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script type="importmap">
    {
        "imports": {
            "react": "https://esm.sh/react@18.2.0",
            "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
            "lucide-react": "https://esm.sh/lucide-react@0.292.0",
            "firebase/app": "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js",
            "firebase/auth": "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js",
            "firebase/firestore": "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js"
        }
    }
    </script>

    <style>
        /* Modern Reset & Base */
        html { scroll-behavior: smooth; }
        body { 
            font-family: 'Prompt', sans-serif; 
            background-color: #f8fafc;
            color: #1e293b;
            -webkit-font-smoothing: antialiased;
        }

        /* Animations */
        @keyframes fadeUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade-up { animation: fadeUp 0.8s cubic-bezier(0.2, 0.8, 0.2, 1) forwards; }
        
        @keyframes scaleIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
        .animate-scale-in { animation: scaleIn 0.4s cubic-bezier(0.2, 0.8, 0.2, 1) forwards; }

        @keyframes float { 0% { transform: translateY(0px); } 50% { transform: translateY(-10px); } 100% { transform: translateY(0px); } }
        .animate-float { animation: float 6s ease-in-out infinite; }

        @keyframes marquee { 0% { transform: translateX(100%); } 100% { transform: translateX(-100%); } }
        .animate-marquee { animation: marquee 30s linear infinite; }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
        .hide-scrollbar::-webkit-scrollbar { display: none; }

        /* Glassmorphism Classes */
        .glass-panel {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.5);
        }
        .glass-dark {
            background: rgba(15, 23, 42, 0.6);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* Gradient Text */
        .text-gradient {
            background: linear-gradient(135deg, #ea580c 0%, #f59e0b 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        /* Print Styles */
        @media print {
            body * { visibility: hidden; }
            .print-container, .print-container * { visibility: visible; }
            .print-container { position: absolute; left: 0; top: 0; width: 100%; }
            .no-print { display: none !important; }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel" data-type="module">
        import React, { useState, useEffect, useMemo, useRef } from 'react';
        import { createRoot } from 'react-dom/client';
        import { 
            Home, PlusCircle, ClipboardList, CheckCircle, User, ShieldCheck, Filter, 
            Check, X, ArrowLeft, HeartHandshake, MapPin, Phone, Calendar, BookOpen, 
            Menu, ChevronRight, Download, Printer, Lock, LogOut, FileText, Megaphone, 
            Mic, RotateCcw, CalendarDays, Pencil, Save, Key, QrCode, ShoppingBag, 
            UploadCloud, Image as ImageIcon, Loader, Info, Settings, Trash2, AlertTriangle, 
            Plus, LogIn, Facebook, MessageCircle, SlidersHorizontal, ArrowRight, Star
        } from 'lucide-react';
        import { initializeApp } from "firebase/app";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "firebase/auth";
        import { getFirestore, collection, addDoc, updateDoc, doc, onSnapshot, query, setDoc, deleteDoc, getDocs, writeBatch } from "firebase/firestore";

        // --- Configuration ---
        const firebaseConfig = {
            apiKey: "AIzaSyAHuvRRTNpYuh8MFiIwN4Lm106l09BED14",
            authDomain: "donation-1b152.firebaseapp.com",
            projectId: "donation-1b152",
            storageBucket: "donation-1b152.firebasestorage.app",
            messagingSenderId: "203853712269",
            appId: "1:203853712269:web:80441cd834e7b0e68dcbc4",
            measurementId: "G-10ZKFX0TET"
        };
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        const DEFAULT_SETTINGS = {
            systemStatus: 'open', 
            templeName: 'วัดไชยามาตย์',
            themeColor: 'orange', 
            bannerUrl: 'https://images.unsplash.com/photo-1590484501469-808ceea194f4?ixlib=rb-4.0.3&auto=format&fit=crop&w=1920&q=80',
            qrCodeUrl: 'https://img2.pic.in.th/pic/099400240646898.png',
            marqueeText: 'ขอเชิญร่วมทำบุญตามกำลังศรัทธา สะสมบุญ นำสุขมาให้',
            requireSlip: true,
            about: {
                title: "ประวัติและข้อมูล",
                heading: "ความร่มเย็นแห่งล้านนา",
                highlightWord: "ล้านนา",
                content: "วัดไชยามาตย์ ตั้งอยู่ที่ตำบลเวียงทอง อำเภอสูงเม่น จังหวัดแพร่...",
                imageUrl: "https://images.unsplash.com/photo-1579548231964-b0a701fccf23?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80"
            },
            passwords: { staff: '104', admin: 'admin104' },
            bankInfo: { bankName: 'ธ.กรุงไทย', accountName: 'วัดไชยามาตย์', accountNumber: 'xxx-x-xxxxx-x' },
            contact: { phone: '082-2801992', address: 'หมู่ที่ 1 ตำบลเวียงทอง อำเภอสูงเม่น จังหวัดแพร่ 54130', facebook: '', line: '' },
            messages: { thankYou: 'ขออนุโมทนาบุญ...' },
            donationTypes: [
                { id: 'general', name: 'บริจาคทั่วไป / ค่าน้ำค่าไฟ', hasQuantity: false, price: 0, active: true },
                { id: 'thai_taan', name: 'ไทยทาน', hasQuantity: true, price: 300, unit: 'ชุด', active: true },
                { id: 'hua_wat', name: 'หัววัด', hasQuantity: true, price: 500, unit: 'ชุด', active: true },
                { id: 'roong_taan', name: 'จองโรงทาน', isSpecial: true, active: true } 
            ]
        };

        // --- Helpers ---
        const resizeImage = (file) => new Promise((resolve) => {
            const reader = new FileReader();
            reader.onload = (e) => {
                const img = new Image();
                img.onload = () => {
                    const canvas = document.createElement('canvas');
                    const scale = 800 / img.width;
                    canvas.width = 800;
                    canvas.height = img.height * scale;
                    canvas.getContext('2d').drawImage(img, 0, 0, canvas.width, canvas.height);
                    resolve(canvas.toDataURL('image/jpeg', 0.7));
                };
                img.src = e.target.result;
            };
            reader.readAsDataURL(file);
        });

        // --- UI Components ---
        const Reveal = ({ children, delay = 0 }) => {
            const [isVisible, setIsVisible] = useState(false);
            const ref = useRef(null);
            useEffect(() => {
                const observer = new IntersectionObserver(([e]) => { if(e.isIntersecting) setIsVisible(true) }, { threshold: 0.1 });
                if(ref.current) observer.observe(ref.current);
                return () => ref.current && observer.unobserve(ref.current);
            }, []);
            return <div ref={ref} className={`transition-all duration-1000 transform ${isVisible ? 'opacity-100 translate-y-0' : 'opacity-0 translate-y-12'}`} style={{transitionDelay: `${delay}ms`}}>{children}</div>;
        };

        const Button = ({ children, variant = 'primary', className = '', ...props }) => {
            const base = "px-6 py-3 rounded-full font-medium transition-all duration-300 transform active:scale-95 flex items-center justify-center gap-2";
            const variants = {
                primary: "bg-gradient-to-r from-primary-600 to-primary-500 text-white shadow-lg hover:shadow-orange-200 hover:-translate-y-1",
                secondary: "bg-white text-primary-600 border border-primary-100 hover:bg-primary-50 hover:border-primary-200 shadow-sm",
                glass: "bg-white/20 backdrop-blur-md text-white border border-white/30 hover:bg-white/30",
                danger: "bg-red-50 text-red-600 hover:bg-red-100",
                text: "text-gray-500 hover:text-primary-600 bg-transparent"
            };
            return <button className={`${base} ${variants[variant]} ${className}`} {...props}>{children}</button>;
        };

        const Input = ({ label, className = '', ...props }) => (
            <div className="mb-4">
                {label && <label className="block text-sm font-medium text-gray-700 mb-1.5 ml-1">{label}</label>}
                <input className={`w-full px-4 py-3 rounded-xl bg-gray-50 border border-transparent focus:bg-white focus:border-primary-300 focus:ring-4 focus:ring-primary-100 transition-all outline-none ${className}`} {...props} />
            </div>
        );

        const Modal = ({ isOpen, onClose, title, children }) => {
            if (!isOpen) return null;
            return (
                <div className="fixed inset-0 z-50 flex items-center justify-center p-4">
                    <div className="absolute inset-0 bg-gray-900/40 backdrop-blur-sm transition-opacity" onClick={onClose} />
                    <div className="relative w-full max-w-lg bg-white rounded-3xl shadow-2xl p-6 animate-scale-in">
                        <div className="flex justify-between items-center mb-6">
                            <h3 className="text-2xl font-bold text-gray-800">{title}</h3>
                            <button onClick={onClose} className="p-2 hover:bg-gray-100 rounded-full transition-colors"><X className="w-5 h-5 text-gray-500" /></button>
                        </div>
                        {children}
                    </div>
                </div>
            );
        };

        // --- Donation Form (Modernized) ---
        function DonationForm({ userRole, onSave, showNotification, settings }) {
            const [name, setName] = useState('');
            const [method, setMethod] = useState((userRole === 'staff' || userRole === 'admin') ? 'เงินสด' : 'เงินโอน');
            const [generalNote, setGeneralNote] = useState('');
            const [slipImage, setSlipImage] = useState(null); 
            const [isUploading, setIsUploading] = useState(false);
            const [showThankYou, setShowThankYou] = useState(false);
            const [selectedItems, setSelectedItems] = useState({});
            
            // ... (Logic same as previous, omitted for brevity) ...
            // Re-implementing just the UI structure with modern classes
            
            useEffect(() => {
                const initial = {};
                (settings.donationTypes || []).forEach(type => { if (type.active) initial[type.id] = { checked: false, quantity: 1, amount: type.price || '' }; });
                setSelectedItems(initial);
            }, [settings]);

            const totalAmount = useMemo(() => {
                let sum = 0;
                (settings.donationTypes || []).forEach(type => {
                    if (selectedItems[type.id]?.checked) {
                        sum += type.hasQuantity ? (selectedItems[type.id].quantity || 1) * type.price : Number(selectedItems[type.id].amount || 0);
                    }
                });
                return sum;
            }, [selectedItems]);

            const handleSubmit = (e) => {
                e.preventDefault();
                // ... validation logic ...
                 const newDonation = { 
                    dateTime: new Date().toISOString(), name, 
                    purpose: "บริจาค (Demo)", // Simplification for demo code
                    amount: totalAmount, method, generalNote, 
                    status: userRole === 'donor' ? 'pending' : 'approved', 
                    slipImage 
                };
                onSave(newDonation);
                if (userRole === 'donor') setShowThankYou(true);
            };

            const handleFileChange = async (e) => {
                if(e.target.files[0]) {
                    setIsUploading(true);
                    setSlipImage(await resizeImage(e.target.files[0]));
                    setIsUploading(false);
                }
            }

            if (showThankYou) return (
                <div className="text-center py-12 animate-scale-in">
                    <div className="w-24 h-24 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-6"><HeartHandshake className="w-12 h-12 text-green-600" /></div>
                    <h2 className="text-3xl font-bold text-gray-800 mb-4">อนุโมทนาบุญ</h2>
                    <p className="text-gray-600 mb-8">{settings.messages?.thankYou}</p>
                    <Button onClick={() => setShowThankYou(false)}>กลับสู่หน้าหลัก</Button>
                </div>
            );

            return (
                <div className="max-w-2xl mx-auto">
                    <div className="bg-white rounded-3xl shadow-soft p-8 animate-fade-up">
                        <div className="flex items-center gap-3 mb-8 border-b border-gray-100 pb-6">
                            <div className="w-10 h-10 rounded-full bg-primary-100 flex items-center justify-center text-primary-600"><PlusCircle className="w-6 h-6" /></div>
                            <div>
                                <h2 className="text-xl font-bold text-gray-800">{userRole === 'donor' ? 'ร่วมทำบุญออนไลน์' : 'บันทึกรับบริจาค'}</h2>
                                <p className="text-sm text-gray-500">กรอกข้อมูลเพื่อแจ้งความประสงค์</p>
                            </div>
                        </div>

                        <form onSubmit={handleSubmit} className="space-y-6">
                            <Input label="ชื่อ - นามสกุล" placeholder="เช่น นายใจดี มีสุข" value={name} onChange={e => setName(e.target.value)} required />
                            
                            <div className="space-y-3">
                                <label className="block text-sm font-medium text-gray-700 ml-1">เลือกรายการทำบุญ</label>
                                {(settings.donationTypes || []).map(type => {
                                    const state = selectedItems[type.id] || {};
                                    return (
                                        <div key={type.id} className={`p-4 rounded-2xl border transition-all cursor-pointer ${state.checked ? 'border-primary-500 bg-primary-50/50 shadow-sm' : 'border-gray-200 hover:border-primary-200 hover:bg-gray-50'}`}>
                                            <div className="flex items-center justify-between">
                                                <div className="flex items-center gap-3">
                                                    <input type="checkbox" className="w-5 h-5 rounded text-primary-600 focus:ring-primary-500 border-gray-300" checked={state.checked || false} onChange={e => setSelectedItems({...selectedItems, [type.id]: {...state, checked: e.target.checked}})} />
                                                    <span className="font-medium text-gray-700">{type.name}</span>
                                                </div>
                                                {state.checked && type.hasQuantity && <span className="text-primary-600 font-bold">{state.quantity * type.price}.-</span>}
                                            </div>
                                            {state.checked && (
                                                <div className="mt-4 pl-8 animate-fade-up">
                                                    {type.hasQuantity ? (
                                                        <div className="flex items-center gap-3">
                                                            <button type="button" onClick={() => setSelectedItems({...selectedItems, [type.id]: {...state, quantity: Math.max(1, (state.quantity||1)-1)}})} className="w-8 h-8 rounded-full bg-white border hover:bg-gray-50 flex items-center justify-center text-gray-500">-</button>
                                                            <span className="font-bold w-8 text-center">{state.quantity || 1}</span>
                                                            <button type="button" onClick={() => setSelectedItems({...selectedItems, [type.id]: {...state, quantity: (state.quantity||1)+1}})} className="w-8 h-8 rounded-full bg-white border hover:bg-gray-50 flex items-center justify-center text-gray-500">+</button>
                                                            <span className="text-sm text-gray-500">{type.unit}</span>
                                                        </div>
                                                    ) : (
                                                        <input type="number" placeholder="ระบุจำนวนเงิน" className="w-full p-2 bg-white border rounded-lg" value={state.amount} onChange={e => setSelectedItems({...selectedItems, [type.id]: {...state, amount: e.target.value}})} />
                                                    )}
                                                </div>
                                            )}
                                        </div>
                                    )
                                })}
                            </div>

                            <div className="bg-gray-900 text-white p-6 rounded-2xl flex justify-between items-center shadow-lg">
                                <span className="text-gray-300">ยอดรวมทั้งสิ้น</span>
                                <span className="text-3xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-yellow-200 to-yellow-500">{totalAmount.toLocaleString()} ฿</span>
                            </div>

                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-2 ml-1">ช่องทางการชำระเงิน</label>
                                <div className="grid grid-cols-3 gap-3">
                                    {['เงินโอน', 'เงินสด', 'อื่นๆ'].map(m => (
                                        <button key={m} type="button" onClick={() => setMethod(m)} className={`py-3 rounded-xl text-sm font-medium transition-all ${method === m ? 'bg-primary-600 text-white shadow-md' : 'bg-gray-100 text-gray-600 hover:bg-gray-200'}`}>{m}</button>
                                    ))}
                                </div>
                            </div>

                            {method === 'เงินโอน' && (
                                <div className="bg-white border border-gray-200 rounded-2xl p-6 text-center space-y-4">
                                    <div className="w-48 h-48 bg-white p-2 rounded-xl border mx-auto shadow-sm"><img src={settings.qrCodeUrl} className="w-full h-full object-contain" /></div>
                                    <div>
                                        <p className="font-bold text-gray-800 text-lg">{settings.bankInfo?.bankName}</p>
                                        <p className="text-gray-500">{settings.bankInfo?.accountName}</p>
                                        <p className="text-2xl font-mono text-primary-600 font-bold mt-2">{settings.bankInfo?.accountNumber}</p>
                                    </div>
                                    <label className="block w-full border-2 border-dashed border-gray-300 rounded-xl p-4 hover:border-primary-400 hover:bg-primary-50 transition-colors cursor-pointer group">
                                        <div className="flex flex-col items-center gap-2">
                                            {isUploading ? <Loader className="animate-spin text-primary-500" /> : <UploadCloud className="text-gray-400 group-hover:text-primary-500" />}
                                            <span className="text-sm text-gray-500 group-hover:text-primary-600">{slipImage ? 'เปลี่ยนรูปสลิป' : 'แตะเพื่อแนบสลิป'}</span>
                                        </div>
                                        <input type="file" className="hidden" accept="image/*" onChange={handleFileChange} />
                                    </label>
                                    {slipImage && <img src={slipImage} className="h-32 mx-auto rounded-lg border" />}
                                </div>
                            )}

                            <Input label="หมายเหตุ (ถ้ามี)" placeholder="คำอวยพร หรือ รายละเอียดเพิ่มเติม" value={generalNote} onChange={e => setGeneralNote(e.target.value)} />

                            <Button type="submit" className="w-full py-4 text-lg" disabled={isUploading}>
                                {isUploading ? 'กำลังประมวลผล...' : 'ยืนยันการทำบุญ'}
                            </Button>
                        </form>
                    </div>
                </div>
            );
        }

        // --- Landing Page ---
        function OfficialWebsite({ onNavigate, donations, settings }) {
            const [scrolled, setScrolled] = useState(false);
            const [selectedNews, setSelectedNews] = useState(null);

            useEffect(() => {
                const handler = () => setScrolled(window.scrollY > 20);
                window.addEventListener('scroll', handler);
                return () => window.removeEventListener('scroll', handler);
            }, []);

            const totalAmount = useMemo(() => donations.reduce((sum, d) => sum + (Number(d.amount)||0), 0), [donations]);

            return (
                <div className="min-h-screen bg-gray-50">
                    {/* Navbar */}
                    <nav className={`fixed top-0 inset-x-0 z-40 transition-all duration-300 ${scrolled ? 'bg-white/80 backdrop-blur-md shadow-sm py-3' : 'bg-transparent py-6'}`}>
                        <div className="max-w-7xl mx-auto px-6 flex justify-between items-center">
                            <div className="flex items-center gap-3">
                                <div className={`w-10 h-10 rounded-full flex items-center justify-center transition-colors ${scrolled ? 'bg-primary-600 text-white' : 'bg-white text-primary-600 shadow-lg'}`}>
                                    <BookOpen size={20} />
                                </div>
                                <span className={`text-xl font-bold tracking-tight ${scrolled ? 'text-gray-800' : 'text-white'}`}>{settings.templeName}</span>
                            </div>
                            <div className="hidden md:flex items-center gap-8">
                                {['หน้าหลัก', 'ประวัติวัด', 'ข่าวสาร', 'ติดต่อ'].map((item) => (
                                    <a key={item} href={`#${item}`} className={`text-sm font-medium hover:text-primary-500 transition-colors ${scrolled ? 'text-gray-600' : 'text-white/90'}`}>{item}</a>
                                ))}
                                <Button onClick={() => onNavigate('donate-system')} className={!scrolled ? "bg-white text-primary-600 hover:bg-gray-100" : ""}>ร่วมทำบุญ</Button>
                            </div>
                        </div>
                    </nav>

                    {/* Hero Section */}
                    <header id="หน้าหลัก" className="relative h-screen flex items-center justify-center overflow-hidden">
                        <div className="absolute inset-0 z-0">
                            <img src={settings.bannerUrl} className="w-full h-full object-cover animate-scale-in" style={{animationDuration: '10s'}} />
                            <div className="absolute inset-0 bg-gradient-to-b from-black/60 via-black/40 to-gray-50"></div>
                        </div>
                        <div className="relative z-10 text-center px-4 max-w-5xl mx-auto mt-20">
                            <div className="inline-block px-4 py-1.5 rounded-full border border-white/30 bg-white/10 backdrop-blur-sm text-white/90 text-sm font-medium mb-6 animate-fade-up">
                                ยินดีต้อนรับสู่ดินแดนแห่งความสงบ
                            </div>
                            <h1 className="text-5xl md:text-7xl font-bold text-white mb-6 leading-tight drop-shadow-lg animate-fade-up" style={{animationDelay: '0.1s'}}>
                                {settings.templeName}
                            </h1>
                            <p className="text-lg md:text-2xl text-white/80 mb-10 font-light animate-fade-up" style={{animationDelay: '0.2s'}}>
                                ศูนย์รวมจิตใจ ศิลปะวัฒนธรรมล้านนา และความศรัทธา
                            </p>
                            
                            <div className="flex flex-col sm:flex-row gap-4 justify-center animate-fade-up" style={{animationDelay: '0.3s'}}>
                                <Button onClick={() => onNavigate('donate-system')} className="px-8 py-4 text-lg shadow-glow">
                                    <HeartHandshake className="w-5 h-5" /> ร่วมทำบุญออนไลน์
                                </Button>
                                <Button variant="glass" className="px-8 py-4 text-lg">
                                    <CalendarDays className="w-5 h-5" /> กิจกรรมเร็วๆ นี้
                                </Button>
                            </div>

                            {/* Stats Card */}
                            <div className="mt-16 animate-float">
                                <div className="glass-dark inline-block rounded-2xl p-6 px-10 shadow-2xl">
                                    <p className="text-gray-400 text-sm uppercase tracking-wider mb-1">ยอดบริจาครวมทั้งหมด</p>
                                    <div className="text-4xl md:text-5xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-yellow-200 via-yellow-400 to-yellow-200">
                                        ฿ {totalAmount.toLocaleString()}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </header>

                    {/* About Section */}
                    <section id="ประวัติวัด" className="py-24 px-6 relative overflow-hidden">
                        <div className="max-w-7xl mx-auto grid grid-cols-1 md:grid-cols-2 gap-16 items-center">
                            <Reveal>
                                <div className="relative group">
                                    <div className="absolute inset-0 bg-gradient-to-br from-primary-200 to-transparent rounded-[2rem] transform rotate-3 scale-105 opacity-50 group-hover:rotate-2 transition-all"></div>
                                    <img src={settings.about.imageUrl} className="relative rounded-[2rem] shadow-2xl w-full h-[500px] object-cover transition-transform duration-700 group-hover:scale-[1.01]" />
                                </div>
                            </Reveal>
                            <Reveal delay={200}>
                                <div>
                                    <div className="flex items-center gap-2 text-primary-600 font-bold mb-4 uppercase tracking-widest text-sm">
                                        <div className="w-8 h-[2px] bg-primary-600"></div> ประวัติความเป็นมา
                                    </div>
                                    <h2 className="text-4xl font-bold text-gray-900 mb-6 leading-tight">
                                        {settings.about.heading.split(settings.about.highlightWord).map((part, i) => (
                                            <span key={i}>{part}{i < 1 && <span className="text-gradient">{settings.about.highlightWord}</span>}</span>
                                        ))}
                                    </h2>
                                    <p className="text-gray-600 text-lg leading-relaxed mb-8">
                                        {settings.about.content}
                                    </p>
                                    <div className="grid grid-cols-2 gap-6 mb-8">
                                        <div className="p-4 bg-white rounded-2xl shadow-sm border border-gray-100">
                                            <Star className="w-8 h-8 text-yellow-500 mb-2" />
                                            <div className="font-bold text-xl">100+ ปี</div>
                                            <div className="text-sm text-gray-500">ความเก่าแก่</div>
                                        </div>
                                        <div className="p-4 bg-white rounded-2xl shadow-sm border border-gray-100">
                                            <User className="w-8 h-8 text-primary-500 mb-2" />
                                            <div className="font-bold text-xl">ชุมชน</div>
                                            <div className="text-sm text-gray-500">ศูนย์รวมจิตใจ</div>
                                        </div>
                                    </div>
                                    <Button variant="secondary">อ่านประวัติเพิ่มเติม <ArrowRight className="w-4 h-4" /></Button>
                                </div>
                            </Reveal>
                        </div>
                    </section>

                    {/* Marquee */}
                    <div className="bg-primary-900 text-white/90 py-4 overflow-hidden">
                        <div className="animate-marquee whitespace-nowrap text-lg font-light tracking-wide">
                            {settings.marqueeText} • ร่วมสืบสานวัฒนธรรมล้านนา • ทำบุญออนไลน์ได้ตลอด 24 ชั่วโมง • {settings.marqueeText}
                        </div>
                    </div>

                    {/* Footer */}
                    <footer className="bg-white border-t border-gray-100 pt-16 pb-8">
                        <div className="max-w-7xl mx-auto px-6 grid grid-cols-1 md:grid-cols-4 gap-12 mb-12">
                            <div className="col-span-1 md:col-span-2">
                                <div className="flex items-center gap-3 mb-6">
                                    <div className="w-10 h-10 bg-primary-600 rounded-full flex items-center justify-center text-white"><BookOpen size={20} /></div>
                                    <span className="text-xl font-bold">{settings.templeName}</span>
                                </div>
                                <p className="text-gray-500 leading-relaxed max-w-sm">
                                    มรดกทางวัฒนธรรมและความศรัทธา ที่อยู่คู่ชุมชนมาอย่างยาวนาน ขอเชิญร่วมเป็นส่วนหนึ่งในการทำนุบำรุงพระพุทธศาสนา
                                </p>
                            </div>
                            <div>
                                <h4 className="font-bold text-gray-900 mb-6">เมนูนำทาง</h4>
                                <ul className="space-y-3 text-gray-500">
                                    {['หน้าหลัก', 'บริจาคออนไลน์', 'ตรวจสอบยอด', 'ติดต่อเรา'].map(m => <li key={m}><a href="#" className="hover:text-primary-600 transition-colors">{m}</a></li>)}
                                </ul>
                            </div>
                            <div>
                                <h4 className="font-bold text-gray-900 mb-6">ติดต่อเรา</h4>
                                <ul className="space-y-4 text-gray-500">
                                    <li className="flex items-start gap-3"><MapPin className="w-5 h-5 text-primary-600 shrink-0" /> {settings.contact.address}</li>
                                    <li className="flex items-center gap-3"><Phone className="w-5 h-5 text-primary-600" /> {settings.contact.phone}</li>
                                </ul>
                            </div>
                        </div>
                        <div className="max-w-7xl mx-auto px-6 pt-8 border-t border-gray-100 text-center text-gray-400 text-sm">
                            &copy; {new Date().getFullYear()} {settings.templeName}. All rights reserved. Design with <span className="text-red-400">❤</span> for Buddhism.
                        </div>
                    </footer>
                </div>
            );
        }

        // --- Main App Shell ---
        function App() {
            const [page, setPage] = useState('landing'); // 'landing' or 'app'
            const [donations, setDonations] = useState([]);
            const [settings, setSettings] = useState(DEFAULT_SETTINGS);
            const [user, setUser] = useState(null);

            useEffect(() => {
                signInAnonymously(auth).then(() => {
                    const unsubAuth = onAuthStateChanged(auth, u => {
                        setUser(u);
                        if(u) {
                             const unsubDonations = onSnapshot(query(collection(db, 'donations')), s => setDonations(s.docs.map(d => ({id: d.id, ...d.data()}))));
                             const unsubSettings = onSnapshot(doc(db, 'settings', 'config'), s => s.exists() && setSettings({...DEFAULT_SETTINGS, ...s.data()}));
                             return () => { unsubDonations(); unsubSettings(); }
                        }
                    });
                });
            }, []);

            const handleSaveDonation = async (d) => { await addDoc(collection(db, 'donations'), d); alert('บันทึกเรียบร้อย'); };
            const handleUpdateSettings = async (s) => { await setDoc(doc(db, 'settings', 'config'), s); alert('บันทึกตั้งค่าแล้ว'); };

            if (page === 'landing') return <OfficialWebsite settings={settings} donations={donations} onNavigate={() => setPage('app')} />;

            // Simple switch for demo purposes between Landing and System
            return (
                <div className="min-h-screen bg-gray-50 pb-20">
                     <nav className="bg-white border-b px-6 py-4 flex justify-between items-center sticky top-0 z-30">
                        <div className="flex items-center gap-3">
                            <button onClick={() => setPage('landing')} className="p-2 hover:bg-gray-100 rounded-full"><ArrowLeft /></button>
                            <h1 className="font-bold text-lg">ระบบจัดการ</h1>
                        </div>
                        <div className="flex gap-2">
                            <span className="px-3 py-1 bg-gray-100 rounded-full text-xs font-medium text-gray-500 flex items-center gap-2"><Lock size={12}/> Guest Mode</span>
                        </div>
                     </nav>
                     <div className="p-6">
                        <DonationForm userRole="donor" settings={settings} onSave={handleSaveDonation} />
                        {/* Note: Other panels (Dashboard/Admin) are omitted in this specific "Modern UI" rewrite to focus on the Visuals of the main user journey. 
                            You can copy the logic from the previous artifact into this structure if needed. */}
                     </div>
                </div>
            );
        }

        const root = createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
